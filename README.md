# 自動測試與 TDD 實務開發 第五梯 - Day 1 作業

這個作業其實很值得深思，因為絕對不是只有表面的資料分組和實作演算法而已。我個人認為重點在：該怎麼它們轉換成有意義的形式以合理化需求。

## 需求的定義

從 91 哥提供的各項資訊來看，我把這個需求解釋成：訂單拆分。接下來我定義了幾個角色，粒度由大到小分別為：

* 訂單拆分器 (OrderDivider)
* 拆分規則 (DivideRule)
* 訂單 (Order)
* 訂單集合 (OrderCollection)
* 訂單項目 (OrderItem)

那麼我們可以來定義拆分的規則了。原來的規則定義是「幾筆一組」，但這樣並沒有任何商業意義，所以我把它重新定義成：

1. 「原始訂單」是由客戶下單的，而為了可以讓出貨系統處理，「原始訂單」需要拆分成「可出貨訂單」。
2. 「原始訂單」及「可出貨訂單」包含一個以上的訂單項目。
3. 「可出貨訂單集合」包含一張以上的「可出貨訂單」。
4. 拆分由「訂單拆分器」進行，拆分後，一張「原始訂單」會對應一個「可出貨訂單集合」。
5. 因為出貨系統的限制，「原始訂單」進行拆分後，每張「可出貨訂單」最多只能包含 N 個訂單項目。這個限制規則定義在「拆分規則」上。
6. 如果「原始訂單」中的「訂單項目」不是 N 的倍數，那麼拆分後的最後一個「可出貨訂單」就要包含剩下的「訂單項目」。
7. 「可出貨訂單集合」需要能夠知道每張「可出貨訂單」個別的「 Cost 總和」與「 Revenue 總和」。

不過這樣的定義從實務方面去考量的話，就不見得合乎真正的商業邏輯；也有可能其實不是 91 哥這個需求的原意，必須再跟他進行確認。只是這個作業是要我們自行去定義需求給 developer ，所以我就用自己過往的經驗來試著定義它了。

「可能會有新的欄位，也可能需要針對新的欄位做加總。」這是未來的需求，這裡就是在思考架構時要考慮的，同時也要反應在程式介面的可擴充性上。
